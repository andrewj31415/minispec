<!DOCTYPE html>
<html>
    <head>
        <style>
            :root {
                --button-gray: rgb(192, 192, 192);
                font-size: 12pt;
            }
            html {
                height: 100vh;
                width: 100vw;
                overflow: hidden;
            }
            body {
                background-color: white;
                height: 100%;
                margin: 0;
            }
            #root {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: row;
            }
            #source-div {
                position: relative;
                height: 100%;
                width: 35vw;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
            #source-filenames-div {
                z-index: 100;
                width: 100%;
                background-color: rgb(220, 220, 220);
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                flex-shrink: 0;
            }
            .source-filename-div {
                padding: 10px;
                background-color: var(--button-gray);
                cursor: pointer;
            }
            #source-filetexts-div {
                position: relative;
                width: 100%;
                flex-grow: 1;
            }
            .source-file-div {
                z-index: 0;
                position: absolute;
                white-space: pre;
                overflow: auto;
                width: 100%;
                height: 100%;
                background-color: white;
            }
            #resize-div {
                height: 100%;
                width: 2px;
                background-color: black;
                cursor: e-resize;
            }
            #display-svg {
                object-fit: contain;
                flex: 2;
                cursor: default;
            }
            #control-button-div {
                width: 150px;
                height: 50px;
                position: absolute;
                bottom: 0;
                right: 0;
            }
            #button-fullscreen-background-div {
                z-index: 1;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 105px;
                background-color: var(--button-gray);
            }
            #button-fullscreen-image-embed {
                z-index: 2;
                position: absolute;
                width: 50px;
                height: 50px;
                top: 0px;
                left: 100px;
            }
            #button-fullscreen-click-div {
                z-index: 3;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 105px;
                background-color: transparent;
                cursor: pointer;
            }
            #button-resetzoom-image-embed {
                z-index: 2;
                position: absolute;
                width: 50px;
                height: 50px;
                top: 0px;
                left: 50px;
            }
            #button-resetzoom-background-div {
                z-index: 1;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 55px;
                background-color: var(--button-gray);
            }
            #button-resetzoom-click-div {
                z-index: 3;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 55px;
                background-color: transparent;
                cursor: pointer;
            }
            #button-help-image-embed {
                z-index: 2;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 5px;
            }
            #button-help-background-div {
                z-index: 1;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 5px;
                background-color: var(--button-gray);
            }
            #button-help-click-div {
                z-index: 3;
                position: absolute;
                width: 40px;
                height: 40px;
                top: 5px;
                left: 5px;
                background-color: transparent;
                cursor: pointer;
            }
            #help-div {
                /* See https://codepen.io/imprakash/pen/GgNMXO */
                position: absolute;
            }
            mark {
                background-color: rgb(130, 255, 157);
            }
        </style>
    </head>
    <body>
        <div id="root">
            <div id="source-div">
                <div id="source-filenames-div"></div>
                <div id="source-filetexts-div"></div>
            </div>
            <div id="resize-div" onmousedown="event.preventDefault(); /* prevents highlighting of source when resizing */"></div>
            <svg id="display-svg" viewBox="0 0 100 100"></svg>
            <div id="control-button-div">
                <div id="button-fullscreen-background-div"></div>
                <div id="button-resetzoom-background-div"></div>
                <div id="button-help-background-div"></div>
                <!-- Source: https://thenounproject.com/icon/reset-zoom-54041/ -->
                <embed
                    id="button-resetzoom-image-embed"
                    src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzUycHQiIGhlaWdodD0iNzUycHQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc1MiA3NTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8ZGVmcz4KICA8Y2xpcFBhdGggaWQ9ImEiPgogICA8cGF0aCBkPSJtMTQyIDE2OGg0NzAuNzl2NDMxaC00NzAuNzl6Ii8+CiAgPC9jbGlwUGF0aD4KIDwvZGVmcz4KIDxnIGNsaXAtcGF0aD0idXJsKCNhKSI+CiAgPHBhdGggZD0ibTYwNCA1MjQuNzVjLTAuMzA4NTktMC4yODUxNi0wLjY0NDUzLTAuNDMzNTktMC45MjE4OC0wLjY3OTY5bC04NS40MzgtODMuOTY5LTIxLjU1NS0yMS4xNzZjMjIuMDI3LTQ4LjQ3NyAyMi4xNDEtMTA2LjMtNC43OTY5LTE1Ni44LTQ2LjAwNC04Ni4xNTItMTUzLjUyLTExOC44NS0yMzkuNjctNzIuODc5LTEuODIwMyAwLjk2NDg0LTMuNTM5MSAyLjA1ODYtNS4zMTY0IDMuMDk3Ny0yNy43ODEgMTYuMDc4LTQ5LjY5NSAzOC42MzctNjQuNzE5IDY0LjgwNS05Ljk4NDQtNS4xMjUtMTcuMjE1LTkuNTcwMy0xOC4yNTQtMTAuMjM0IDAuOTgwNDcgMC42MzY3MiAwLjMxMjUgMC4wMzEyNS0wLjkxNzk3LTAuODQzNzUtMC44ODY3Mi0wLjc0MjE5LTEuODk0NS0xLjMyMDMtMi45OTIyLTEuODA4Ni0wLjQxNDA2LTAuMjEwOTQtMC44NTkzNy0wLjM4NjcyLTEuMjE0OC0wLjUwNzgxLTAuOTQ5MjItMC4yOTY4OC0xLjkyNTgtMC40MTQwNi0yLjg3NS0wLjQ0MTQxLTAuMjM0MzgtMC4wMzEyNS0wLjQxNDA2LTAuMDE1NjI1LTAuNjgzNTktMC4wMTU2MjUtMC44MjgxMiAwLjAxNTYyNS0xLjY1NjIgMC4xMDE1Ni0yLjQ2MDkgMC4yODEyNS0wLjA4OTg0NCAwLjAzMTI1LTAuMTc1NzggMC4wMzEyNS0wLjI2NTYzIDAuMDU4NTk0LTMuODc4OSAwLjk2NDg0LTcuMTk5MiAzLjg1MTYtOC40NTcgOC0wLjQ4ODI4IDEuNTI3My0wLjU3ODEyIDMuMDgyLTAuNDQxNDEgNC41OTM4IDAgMC0wLjA0Njg3NSAwLjA0Njg3NS0wLjAxNTYyNSAwLjA1ODU5M3YwLjAzMTI1YzAuMDMxMjUgMS4zMzIgMC4xNzU3OCAyLjc1MzkgMC41MzEyNSA0LjI2NTZsMTUuMzk4IDY2LjIwNyA0LjgxMjUgMjAuNzg1IDQuMjgxMiAxOC4zNDQgMS4zNzUgNS44OTQ1YzIuODE2NCAxMi4yNDIgMTIuNjUyIDE1LjIzIDIxLjg0IDYuNjQwNmwyMC41MDQtMTkuMTU2IDUuODA4Ni01LjQ1MzEgMTMuMzU5LTEyLjQ4OCA0MS4wNy0zOC40MTggMi42NTIzLTIuNDc2NmMwLjMxMjUtMC4yOTY4OCAwLjUxOTUzLTAuNTkzNzUgMC43ODUxNi0wLjg4NjcybDEuNzIyNy0xLjY5MTQtMC4xMjEwOS0wLjAzMTI1YzEuMDcwMy0xLjIxNDggMS45ODgzLTIuNjA1NSAyLjQ4ODMtNC4yMzgzIDAuMTM2NzItMC40Mjk2OSAwLjE3OTY5LTAuODU5MzggMC4yNjU2My0xLjI3MzQgMC43OTY4Ny0zLjE3MTkgMC4xNzU3OC02LjE5MTQtMS44MDg2LTguNzM4My0xLjQ2NDgtMi4xNzk3LTMuNjEzMy0zLjkxMDItNi4zMTI1LTQuNzI2NiAwIDAtMTUuOTY5IDEuMTA5NC0zOC45MzQtMy40ODQ0IDUuMzA0Ny03LjczMDUgMTEuNDk2LTE0LjkwMiAxOC41NDctMjEuMzc5IDcuNDk2MS02Ljg1OTQgMTUuOTQxLTEyLjkzNCAyNS4zMDUtMTcuOTI2IDE3LjU3NC05LjM2MzMgMzYuMzg3LTE0LjA0NyA1NS4wMjctMTQuNTIgNDUuNDg0LTEuMTY4IDg5Ljk4OCAyMi43NTQgMTEyLjg0IDY1LjU1OSAyOC45MTggNTQuMjIzIDEzLjM2MyAxMjAuNDgtMzMuODY3IDE1Ni43My0xLjY0MDYgMS4yNDYxLTMuMjg5MSAyLjQ3NjYtNC45NzY2IDMuNjQ4NC0wLjY1MjM0IDAuNDQxNDEtMS4zMDQ3IDAuODg2NzItMS45NTMxIDEuMzIwMy0wLjQxNDA2IDAuMjk2ODgtMC44NTkzOCAwLjU2MjUtMS4zMDQ3IDAuODQzNzUtMi4yMjI3IDEuNDQxNC00LjUzNTIgMi43NTM5LTYuODc1IDQuMDc0Mi0zMy45MyAxOC43MTUtNzYuMTIxIDIxLjM2My0xMTMuNjYgMy4zNTE2LTQuODkwNi0yLjM1OTQtOS41NDMtNS4wMzkxLTEzLjk4NC03Ljk0MTQtMS4yNzM0LTAuODMyMDMtMi41NjY0LTEuNjg3NS0zLjgyMDMtMi41NzgxLTAuOTE3OTctMC4yOTY4OC0xLjg2NzItMC41MDc4MS0yLjg5MDYtMC41MDc4MS0xLjY3NTggMC4wMzEyNS0zLjIxNDggMC41MTk1My00LjUzMTIgMS4zMzJsLTEuNzA3IDEuMzUxNi0yNy4xNDEgMjEuMTU2LTMuMTA5NCAyLjQxNDFjLTEuMjczNCAxLjUzOTEtMi4wNDY5IDMuNDg0NC0yLjA0NjkgNS42NDg0IDAuMDMxMjUgMS44MjAzIDAuNTkzNzUgMy41MTE3IDEuNTM5MSA0LjkxOCAxLjMzMiAxLjA4MiAyLjY5NTMgMi4xNjQxIDQuMDYyNSAzLjIxNDggOS4zOTA2IDcuMTg3NSAxOS42MTMgMTMuNTM5IDMwLjY4IDE4Ljg0NCAzOS4xMzMgMTguNzg5IDgxLjc3IDIxLjgyIDEyMC44MiAxMS43MzQgMC4xMTcxOSAwIDAuMjM0MzggMC4wNTg1OTQgMC4zODY3MiAwLjA1ODU5NCAxLjY1NjItMC40NDUzMSAzLjMzNTktMC44ODY3MiA0Ljk4MDUtMS4zNTk0IDExLjM0OC0zLjMyMDMgMjIuNTItNy43OTY5IDMzLjM2My0xMy41NzQgNC4zNjcyLTIuMzM5OCA4LjU2MjUtNC44NzUgMTIuNjgtNy41MjM0IDAuNTYyNS0wLjM1NTQ3IDEuMTQ0NS0wLjcwNzAzIDEuNzA3LTEuMDgyIDEuMTk5Mi0wLjc4NTE2IDIuMzU1NS0xLjYxNzIgMy41MzkxLTIuNDE0MSAwLjQxNDA2LTAuMjkyOTcgMC44MDg1OS0wLjU4NTk0IDEuMjE4OC0wLjg3MTA5bDE4LjE1MiAxNy44NzkgODIuNzM0IDgxLjI1NGMwLjE4MzU5IDAuMTg3NSAwLjMzNTk0IDAuNTAzOTEgMC41MjM0NCAwLjcwNzAzIDE0LjE1NiAxNC4wOTggNDAuMTA5IDEwLjk3MyA1OC4wMTItNyAxNy45NjUtMTcuOTQ1IDIxLjA5NC00My45NDUgNy4wMzEyLTU4LjAxMnoiLz4KIDwvZz4KPC9zdmc+Cg=="
                />
                <!-- Source: https://thenounproject.com/icon/fullscreen-1337699/ -->
                <embed
                    id="button-fullscreen-image-embed"
                    src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzUycHQiIGhlaWdodD0iNzUycHQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc1MiA3NTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8Zz4KICA8cGF0aCBkPSJtMTc4LjY4IDE3OC42OHYzOTQuNjVoMzk0LjY1di0zOTQuNjV6bTM1NS4xOSAzNTUuMTloLTMxNS43MnYtMzE1LjcyaDMxNS43MnoiLz4KICA8cGF0aCBkPSJtMzM2LjU0IDQ3NC42NmgtMzEuMjkzbDQ1LjI0Ni00NS4yNDYtMjcuOTAyLTI3LjkwMi00NS4yNDYgNDUuMjQ2di0zMS4yOTdoLTM5LjQ2NXY5OC42NjRoOTguNjZ6Ii8+CiAgPHBhdGggZD0ibTQyOS40MiAzNTAuNDkgNDUuMjQ2LTQ1LjI0NnYzMS4yOTNoMzkuNDY1di05OC42NmgtOTguNjY0djM5LjQ2NWgzMS4yOTdsLTQ1LjI0NiA0NS4yNDZ6Ii8+CiA8L2c+Cjwvc3ZnPgo="
                />
                <!-- Source: https://thenounproject.com/icon/help-2647215/ -->
                <embed
                    id="button-help-image-embed"
                    src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzUycHQiIGhlaWdodD0iNzUycHQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc1MiA3NTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8ZGVmcz4KICA8Y2xpcFBhdGggaWQ9ImIiPgogICA8cGF0aCBkPSJtMjE5IDEzOS4yMWgzMTR2MzI4Ljc5aC0zMTR6Ii8+CiAgPC9jbGlwUGF0aD4KICA8Y2xpcFBhdGggaWQ9ImEiPgogICA8cGF0aCBkPSJtMzEyIDUxMGgxMDN2MTAyLjc5aC0xMDN6Ii8+CiAgPC9jbGlwUGF0aD4KIDwvZGVmcz4KIDxnPgogIDxnIGNsaXAtcGF0aD0idXJsKCNiKSI+CiAgIDxwYXRoIGQ9Im0zNjguNTcgMTM5LjIxYzMwLjUyLTAuNDQ5MjIgNjAuODA1IDUuMzY3MiA4OC45ODQgMTcuMDk4IDIzLjg2NyA5LjU2MjUgNDQuMTAyIDI2LjQxOCA1Ny44MjQgNDguMTYgMTYuNjg4IDI3LjAyMyAyMS40NjkgNTkuNzM4IDEzLjIxNSA5MC40MS01LjIxMDkgMjEuMTIxLTE3Ljk5NiAzOC4xMjUtMzMuMTUyIDUzLjMyNC0xMi42NTIgMTEuOTY5LTI2LjE4OCAyMi45NzMtNDAuNDg4IDMyLjkxNC0xMC4zNzEgNy41NzgxLTIwLjUwOCAxNS41MzUtMzAuNTk0IDIzLjY4LTYuODQzOCA1Ljg2MzMtMTIuMDc4IDEzLjM3OS0xNS4yMDMgMjEuODMyLTIuNTU4NiA2LjAzMTItNS4wODIgMTIuMDc4LTcuNTc4MSAxOC4xMzctNS42ODM2IDE0LjU4Ni0xNy4xNDUgMjEuMjE1LTMyLjE1NiAyMi4xNjQtOS4xOTE0IDEuMjE0OC0xOC41MzEtMC42MzI4MS0yNi41NjYtNS4yNTc4LTYuNTIzNC00LjA3ODEtMTEuODItOS44NDM4LTE1LjMzMi0xNi42OTEtMy41MDc4LTYuODQzOC01LjEwMTYtMTQuNTEyLTQuNjA1NS0yMi4xODggMC41MTU2My0xOS4wMiA4LjExNzItMzcuMTU2IDIxLjMwOS01MC44NjMgMTQuNjMzLTE2LjYyMSAzMi43MjMtMjkuMjE5IDQ5Ljg2Ny00Mi45MDZoMC4wMDM5MDZjMTMuMjk3LTkuNjUyMyAyNC43NjItMjEuNjAyIDMzLjg1OS0zNS4yODEgMTIuNDU3LTIwLjYwMiA4LjU3MDMtNTQuNDYxLTEyLjY0NS02OS40NzN2LTAuMDAzOTA2Yy03LjY2OC01LjM5NDUtMTYuNDYxLTguOTcyNy0yNS43MTUtMTAuNDY1LTE0LjA5OC0yLjYzNjctMjguNjI1LTEuODI0Mi00Mi4zNCAyLjM2NzItMTUuOTE0IDUuMDE5NS0yNi4wOTQgMTYuNTc0LTMzLjU3OCAzMC45NzMtNS40NDUzIDEwLjUxMi0xMC4zMjQgMjEuNDA2LTE2LjU3NCAzMS40NDUtMTAuNTEyIDE2Ljk1My0yOC4wODIgMjAuNjQ4LTQ1Ljc0NiAxNy40M3YtMC4wMDM5MDZjLTcuNzA3LTEuMjA3LTE0Ljg4My00LjY4MzYtMjAuNjAyLTkuOTkyMi03LjY3NTgtNy41MjM0LTExLjcwMy0xOC4wMTYtMTEuMDM1LTI4Ljc0NiAwLjI3NzM0LTE4LjMwMSA2LjAzNTItMzYuMTAyIDE2LjUyNy01MS4wOTggMTcuNjI1LTI1LjMyOCA0Mi42NTItNDQuNTg2IDcxLjY1Ni01NS4xMjUgMTkuMzc1LTcuNDYwOSAzOS45MDYtMTEuNDY5IDYwLjY2NC0xMS44NHoiLz4KICA8L2c+CiAgPGcgY2xpcC1wYXRoPSJ1cmwoI2EpIj4KICAgPHBhdGggZD0ibTQxNC42IDU2MS42YzAgMjguMjczLTIyLjkxOCA1MS4xOTUtNTEuMTk1IDUxLjE5NS0yOC4yNzMgMC01MS4xOTEtMjIuOTIyLTUxLjE5MS01MS4xOTUgMC0yOC4yNzMgMjIuOTE4LTUxLjE5NSA1MS4xOTEtNTEuMTk1IDI4LjI3NyAwIDUxLjE5NSAyMi45MjIgNTEuMTk1IDUxLjE5NSIvPgogIDwvZz4KIDwvZz4KPC9zdmc+Cg=="
                />
                <div id="button-fullscreen-click-div" onclick="document.documentElement.requestFullscreen()"></div>
                <div id="button-resetzoom-click-div" onclick="svgDisplay.setAttribute('viewBox', '0 0 100 100')"></div>
                <div
                    id="button-help-click-div"
                    onclick="console.log('Asking for help!')"
                    onmousedown="event.preventDefault(); /* prevents highlighting of div when clicking on icon */"
                ></div>
            </div>
        </div>
        <script defer>
            /* Globals */
            sourceDisplay = document.getElementById("source-div"); //The div with the source code
            sourceFilenameDisplay = document.getElementById("source-filenames-div"); //The div with the clickable filenames
            sourceFiletextDisplay = document.getElementById("source-filetexts-div"); //The div with the text of the files
            resizeDiv = document.getElementById("resize-div"); //The bar for resizing the display
            svgDisplay = document.getElementById("display-svg"); //The svg with the diagram
            startingFontSize = 100; //in pt
            fontShrinkFactor = 0.75; //all fonts will have size startingFontSize*(fontShrinkFactor)^k for some integer k
            getSVGViewBox = () =>
                svgDisplay
                    .getAttribute("viewBox")
                    .split(" ")
                    .map((item) => Number(item)); //returns the viewbox of svgDisplay as an array of four numbers.

            /* Given a mouse event from an event listener, returns {x: number, y: number}
                            where x and y are the svg coordinates of the click on svgDisplay.
                            See https://stackoverflow.com/questions/29261304/how-to-get-the-click-coordinates-relative-to-svg-element-holding-the-onclick-lis
                        */
            getSVGCoordinates = (event) => {
                let pt = svgDisplay.createSVGPoint();
                pt.x = event.clientX;
                pt.y = event.clientY;
                let cursorpt = pt.matrixTransform(svgDisplay.getScreenCTM().inverse());
                return cursorpt;
            };

            /* Allow the user to zoom in/out on the svg by scrolling. */
            svgDisplay.addEventListener("wheel", (e) => {
                let coords = getSVGCoordinates(e);
                let rescaleFactor = 2 ** (e.deltaY / 100);
                let currentSVGViewBox = getSVGViewBox();
                currentSVGViewBox = [
                    currentSVGViewBox[0] * rescaleFactor + coords.x * (1 - rescaleFactor),
                    currentSVGViewBox[1] * rescaleFactor + coords.y * (1 - rescaleFactor),
                    currentSVGViewBox[2] * rescaleFactor,
                    currentSVGViewBox[3] * rescaleFactor,
                ];
                svgDisplay.setAttribute("viewBox", currentSVGViewBox.join(" "));
            });

            /* Allow the user to click to zoom and drag to move
                            See https://www.petercollingridge.co.uk/tutorials/svg/interactive/dragging/
                        */
            isSVGDragging = false;
            startSVGDragging = (event) => {
                isSVGDragging = true;
                let coords = getSVGCoordinates(event);
                svgDraggingX = coords.x;
                svgDraggingY = coords.y;
            };
            stopSVGDragging = () => {
                isSVGDragging = false;
            };
            svgDisplay.addEventListener("mousedown", startSVGDragging);
            window.addEventListener("mouseup", stopSVGDragging);
            window.addEventListener("mousemove", (event) => {
                if (isSVGDragging) {
                    let newCoords = getSVGCoordinates(event);
                    let currentSVGViewBox = getSVGViewBox();
                    currentSVGViewBox = [
                        currentSVGViewBox[0] + svgDraggingX - newCoords.x,
                        currentSVGViewBox[1] + svgDraggingY - newCoords.y,
                        currentSVGViewBox[2],
                        currentSVGViewBox[3],
                    ];
                    svgDisplay.setAttribute("viewBox", currentSVGViewBox.join(" "));
                }
            });

            /* Allow the user to resize the text display/svg display.
                            See https://medium.com/the-z/making-a-resizable-div-in-js-is-not-easy-as-you-think-bda19a1bc53d */
            isResizing = false;
            startResize = (event) => {
                isResizing = true;
            };
            stopResize = () => {
                isResizing = false;
            };
            resizeDiv.addEventListener("mousedown", startResize);
            window.addEventListener("mouseup", stopResize);
            window.addEventListener("mousemove", (event) => {
                if (isResizing) {
                    sourceDisplay.style.width = event.pageX + "px";
                }
            });

            /* Takes in a line of text and an object with x, y, width, and height attributes.
                        Fits the text to the box, adds it to the DOM, and returns a reference to the resulting
                        DOM object.
                        Shrinks the font size to fit vertically. */
            fitText = (text, element) => {
                let textBox = document.createElementNS("http://www.w3.org/2000/svg", "text");
                textBox.innerHTML = text;
                textBox.setAttribute("x", element.x + element.width / 2);
                textBox.setAttribute("y", element.y + element.height / 2);
                textBox.setAttribute("dominant-baseline", "middle");
                textBox.setAttribute("text-anchor", "middle");
                textBox.setAttribute("font-size", String(startingFontSize) + "pt");
                textBox.style.userSelect = "none";
                svgDisplay.appendChild(textBox);

                //fix the font size to fit vertically
                let currentSize = startingFontSize;
                while (textBox.getBBox().height > element.height) {
                    currentSize = currentSize * fontShrinkFactor;
                    textBox.setAttribute("font-size", String(currentSize) + "pt");
                }

                //use ellipses to shrink the text horizontally, leaving at least two letters behind
                if (textBox.getBBox().width > element.width) {
                    textBox.innerHTML += "...";
                    while (textBox.getBBox().width > element.width && textBox.innerHTML.length > 5) {
                        //remove the last letter before the ellipses
                        textBox.innerHTML = textBox.innerHTML.slice(0, -4) + "...";
                    }
                }
                return textBox;
            };

            /* Sources will be stored using sources: Array<{ filename: string, text: string }> */

            sources = [
                {
                    filename: "fourbitcounter",
                    text: `import twobitcounter

module FourBitCounter;
    TwoBitCounter lower;
    TwoBitCounter upper;
    method Bit#(4) getCount;
        return {upper.getCount, lower.getCount};
    endmethod
    input Bool enable;
    rule increment;
        lower.enable = enable;
        upper.enable = enable && (lower.getCount == 3);
    endrule
endmodule
`,
                },
                {
                    filename: "twobitcounter",
                    text: `module TwoBitCounter;
    Reg#(Bit#(2)) count(0);
    method Bit#(2) getCount = count;
    input Bool enable;
    rule increment;
        if (enable)
            count <= count + 1;
    endrule
endmodule
`,
                },
            ];

            /* Put the sources into the document */
            sourceDivs = [];
            sourceTitleDivs = [];

            /* Given an index into the source array, pulls out the given source. */
            pullGivenSource = (index) => {
                sourceDivs.map((sourceDiv) => {
                    sourceDiv.style.zIndex = 0;
                });
                sourceTitleDivs.map((sourceTitle) => {
                    sourceTitle.style.backgroundColor = "var(--button-gray)";
                });
                sourceDivs[index].style.zIndex = 1;
                sourceTitleDivs[index].style.backgroundColor = "white";
            };

            for (let source of sources) {
                let newSource = document.createElement("div");
                newSource.classList.add("source-file-div");
                newSource.innerHTML = source.text;
                sourceFiletextDisplay.appendChild(newSource);
                sourceDivs.push(newSource);

                let newSourceTitle = document.createElement("div");
                newSourceTitle.classList.add("source-filename-div");
                newSourceTitle.innerHTML = source.filename;
                newSourceTitle.addEventListener("mousedown", (event) => {});
                newSourceTitle.addEventListener("click", (event) => {
                    sourceDivs.map((sourceDiv, index) => {
                        if (sources[index].filename === source.filename) {
                            pullGivenSource(index);
                        }
                    });
                });
                sourceFilenameDisplay.appendChild(newSourceTitle);
                sourceTitleDivs.push(newSourceTitle);
            }
            pullGivenSource(0); //Pull out the first source file to start

            /* An element to place has type
                                        element = { name: string, type: string, variant: "Module" | "Wire",
                                                    uniqueId: string
                                                    source: Array<[number, number]>, typeSource: Array<[number, number]> }
                                        Module = element & {x: number, y: number, width: number, height: number,
                                                            children: Array<element>}
                                        Wire = element & {startx, starty, endx, endy, x1, x2, height (all numbers)}
                                    */
            elementsToPlace = [
                {
                    name: "Box of Latkes",
                    type: "Box#(5)",
                    variant: "Module",
                    uniqueId: "asdf",
                    source: [
                        [5, 10],
                        [30, 40],
                    ],
                    typeSource: [],
                    x: 10,
                    y: 10,
                    width: 80,
                    height: 60,
                    children: [
                        {
                            name: "SubBox Blah Blah Blah",
                            type: "LittleBox#(3)",
                            variant: "Module",
                            uniqueId: "jkl",
                            source: [[60, 100]],
                            typeSource: [],
                            x: 40,
                            y: 40,
                            width: 10,
                            height: 10,
                            children: [],
                        },
                    ],
                },
            ];
            placeElement = (element) => {
                if (element.variant === "Module") {
                    let overRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    let underRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    for (rect of [overRect, underRect]) {
                        rect.setAttribute("x", element.x);
                        rect.setAttribute("y", element.y);
                        rect.setAttribute("width", element.width);
                        rect.setAttribute("height", element.height);
                        rect.setAttribute("stroke", "black");
                        rect.setAttribute("stroke-width", element.height / 50); //make the thickness proportional to the height so that it does not cover the under text
                        rect.setAttribute("fill", "white");
                    }
                    svgDisplay.appendChild(underRect);
                    for (childElement of element.children) {
                        placeElement(childElement);
                    }
                    svgDisplay.appendChild(overRect);
                    //place text
                    let overName = fitText(element.name, {
                        x: element.x,
                        y: element.y,
                        width: element.width,
                        height: element.height / 2,
                    });
                    let overType = fitText(element.type, {
                        x: element.x,
                        y: element.y + element.height / 2,
                        width: element.width,
                        height: element.height / 2,
                    });
                    let underName = fitText(element.name, {
                        x: element.x,
                        y: element.y + element.height,
                        width: element.width / 2,
                        height: element.height / 8,
                    });
                    let underType = fitText(element.type, {
                        x: element.x,
                        y: element.y + element.height + element.height / 8,
                        width: element.width / 2,
                        height: element.height / 8,
                    });
                    underName.style.visibility = "hidden";
                    underType.style.visibility = "hidden";
                    //handle opening the module
                    let open = () => {
                        overRect.style.visibility = "hidden";
                        overName.style.visibility = "hidden";
                        overType.style.visibility = "hidden";
                        underName.style.visibility = "";
                        underType.style.visibility = "";
                    };
                    overRect.addEventListener("dblclick", () => {
                        open();
                    });
                    overName.addEventListener("dblclick", () => {
                        open();
                    });
                    overType.addEventListener("dblclick", () => {
                        open();
                    });
                }
            };
            for (let element of elementsToPlace) {
                placeElement(element);
            }
            highlightValues = (locations) => {
                //locations is a list of pairs of coordinates.
                let current = 0;
                let text = "";
                for (let selection of locations) {
                    start = selection[0];
                    end = selection[1];
                    text += source.slice(current, start) + "<mark>" + source.slice(start, end) + "</mark>";
                    current = end;
                }
                text += source.slice(current);
                sourceDisplay.innerHTML = text;
            };
            /*highlightValues([
                            [1, 2],
                            [3, 4],
                            [5, 6],
                        ]);*/
        </script>
    </body>
</html>
